import{jsxs as d,jsx as t,Fragment as er}from"@dropins/tools/preact-jsx-runtime.js";import*as H from"@dropins/tools/preact-compat.js";import{useState as J,useEffect as Y}from"@dropins/tools/preact-compat.js";import{classes as o,VComponent as h,Slot as tr}from"@dropins/tools/lib.js";import{events as M}from"@dropins/tools/event-bus.js";import{s as ar,g as ir}from"./state.js";import{g as nr}from"./getEstimatedTotals.js";import{Accordion as cr,AccordionSection as sr,ProgressSpinner as mr,Divider as or,Price as u,Button as ur}from"@dropins/tools/components.js";/* empty css             */import{useText as rr}from"@dropins/tools/i18n.js";const lr=()=>{const[_,O]=J(!1),[C,x]=J();return{handleEstimateTotals:(r,p)=>{O(!0);const{shippingCountry:g,shippingState:l="",shippingStateId:e,shippingZip:y=""}=r,E={countryCode:g,postcode:y,region:{region:l,id:e},shipping_method:{carrier_code:(p==null?void 0:p.carrier_code)||"",method_code:(p==null?void 0:p.method_code)||""}};nr(E).then(a=>{var v,P,c,T,B,w,N,f,I,k,m,A,F,z,G,V,Z,j,U,X;a&&x({estimatedTaxTotal:{amount:(v=a.totalTax)==null?void 0:v.value,currency:(P=a.totalTax)==null?void 0:P.currency},estimatedSubTotal:{excludingTax:{amount:(T=(c=a.subtotal)==null?void 0:c.excludingTax)==null?void 0:T.value,currency:(w=(B=a.subtotal)==null?void 0:B.excludingTax)==null?void 0:w.currency},includingTax:{amount:(f=(N=a.subtotal)==null?void 0:N.includingTax)==null?void 0:f.value,currency:(k=(I=a.subtotal)==null?void 0:I.includingTax)==null?void 0:k.currency},includingDiscountOnly:{amount:(A=(m=a.subtotal)==null?void 0:m.includingDiscountOnly)==null?void 0:A.value,currency:(z=(F=a.subtotal)==null?void 0:F.includingDiscountOnly)==null?void 0:z.currency}},estimatedGrandTotalPrice:{includingTax:{amount:(G=a.total)==null?void 0:G.includingTax.value,currency:(V=a.total)==null?void 0:V.includingTax.currency},excludingTax:{amount:(Z=a.total)==null?void 0:Z.excludingTax.value,currency:(j=a.total)==null?void 0:j.excludingTax.currency}},estimatedAppliedTaxes:{taxes:(U=a.appliedTaxes)==null?void 0:U.map(s=>{var b,n;return{label:s.label,amount:{value:(b=s.amount)==null?void 0:b.value,currency:(n=s.amount)==null?void 0:n.currency}}})},estimatedItems:{items:(X=a.items)==null?void 0:X.map(s=>{var b,n,i,L,D,S,q,$,Q,R;return{uid:s.uid,price:{amount:(b=s.price)==null?void 0:b.value,currency:(n=s.price)==null?void 0:n.currency},taxedPrice:{amount:(i=s.taxedPrice)==null?void 0:i.value,currency:(L=s.taxedPrice)==null?void 0:L.currency},rowTotal:{amount:(D=s.rowTotal)==null?void 0:D.value,currency:(S=s.rowTotal)==null?void 0:S.currency},rowTotalIncludingTax:{amount:(q=s.rowTotalIncludingTax)==null?void 0:q.value,currency:($=s.rowTotalIncludingTax)==null?void 0:$.currency},regularPrice:{amount:(Q=s.regularPrice)==null?void 0:Q.value,currency:(R=s.regularPrice)==null?void 0:R.currency}}})}})}).finally(()=>{O(!1)})},estimatedTotals:C,setEstimatedTotals:x,loading:_}},dr=_=>H.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",..._},H.createElement("path",{d:"M7.74512 9.87701L12.0001 14.132L16.2551 9.87701",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),pr=_=>H.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",..._},H.createElement("path",{d:"M7.74512 14.132L12.0001 9.87701L16.2551 14.132",stroke:"#2B2B2B",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),yr=({className:_,children:O,variant:C="primary",heading:x,loading:W=!0,subTotal:r,shipping:p,discounts:g,taxTotal:l,taxesApplied:e,total:y,primaryAction:E,...a})=>{const[v,P]=J(!1),c=rr({checkout:"Cart.PriceSummary.checkout",discountedPrice:"Cart.CartItem.discountedPrice",download:"Cart.CartItem.download",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",regularPrice:"Cart.CartItem.regularPrice",recipient:"Cart.CartItem.recipient",sender:"Cart.CartItem.sender",file:"Cart.CartItem.file",files:"Cart.CartItem.files",orderSummary:"Cart.PriceSummary.orderSummary",taxesBreakdownTitle:"Cart.PriceSummary.taxes.breakdown",taxTotal:"Cart.PriceSummary.taxes.total",taxEstimated:"Cart.PriceSummary.taxes.estimated",taxTotalOnly:"Cart.PriceSummary.taxes.totalOnly",showTaxBreakdown:"Cart.PriceSummary.taxes.showBreakdown",hideTaxBreakdown:"Cart.PriceSummary.taxes.hideBreakdown",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined",subtotalLabel:"Cart.PriceSummary.subTotal.label",subtotalWithTaxes:"Cart.PriceSummary.subTotal.withTaxes",subtotalWithoutTaxes:"Cart.PriceSummary.subTotal.withoutTaxes",totalEstimated:"Cart.PriceSummary.total.estimated",totalLabel:"Cart.PriceSummary.total.label",totalWithoutTax:"Cart.PriceSummary.total.withoutTax",shippingLabel:"Cart.PriceSummary.shipping.label",zipPlaceholder:"Cart.PriceSummary.shipping.zipPlaceholder",editZipAction:"Cart.PriceSummary.shipping.editZipAction",shippingWithTaxes:"Cart.PriceSummary.shipping.withTaxes",shippingWithoutTaxes:"Cart.PriceSummary.shipping.withoutTaxes",shippingEstimated:"Cart.PriceSummary.shipping.estimated",shippingEstimatedByState:"Cart.PriceSummary.shipping.alternateField.state",shippingEstimatedByZip:"Cart.PriceSummary.shipping.alternateField.zip",destinationLinkAriaLabel:"Cart.PriceSummary.shipping.destinationLinkAriaLabel",applyButton:"Cart.PriceSummary.estimatedShippingForm.apply.label",countryField:"Cart.PriceSummary.estimatedShippingForm.country.placeholder",freeShipping:"Cart.PriceSummary.freeShipping",stateField:"Cart.PriceSummary.estimatedShippingForm.state.placeholder",zipField:"Cart.PriceSummary.estimatedShippingForm.zip.placeholder"}),T=r&&d("div",{className:o(["cart-order-summary__entry","cart-order-summary__subTotal"]),children:[t("span",{className:"cart-order-summary__label",children:c.subtotalLabel}),t(h,{node:r.price,className:"cart-order-summary__price"}),r.taxIncluded&&t("div",{"data-testid":"sub-total-tax-caption",className:"cart-order-summary__caption",children:t("span",{children:c.subtotalWithTaxes})}),r.taxExcluded?t("div",{"data-testid":"sub-total-tax-caption-excluded",className:"cart-order-summary__caption",children:d("span",{children:[r.priceExcludingTax,"Â ",c.subtotalWithoutTaxes]})}):void 0]}),B=p&&t(h,{node:p,className:"cart-order-summary__shipping"}),w=g&&g.length>0&&t(er,{children:g.map(m=>d("div",{className:o(["cart-order-summary__entry","cart-order-summary__discount"]),children:[t("span",{className:"cart-order-summary__label",children:m.label}),t(h,{node:m.price,className:"cart-order-summary__price"}),m.caption&&t(h,{node:m.caption,className:"cart-order-summary__caption"})]},m.label))}),N=e&&e.length>0?t(cr,{"data-testid":"tax-breakdown",className:"cart-order-summary__taxes",iconOpen:dr,iconClose:pr,children:d(sr,{title:c.taxesBreakdownTitle,secondaryText:!v&&l?t(h,{node:l.price,className:"cart-order-summary__price"}):void 0,renderContentWhenClosed:!1,onStateChange:P,children:[t("div",{className:"cart-order-summary__appliedTaxes",children:e.map(m=>d("div",{className:o(["cart-order-summary__entry","cart-order-summary__taxEntry"]),children:[t("span",{className:o(["cart-order-summary__label","cart-order-summary__label--muted"]),children:m.label}),t(h,{node:m.price,className:o(["cart-order-summary__price","cart-order-summary__price--muted"])})]},m.label))}),d("div",{className:o(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[t("span",{className:"cart-order-summary__label",children:c.taxTotal}),l&&t(h,{node:l.price,className:"cart-order-summary__price"})]})]})}):l&&d("div",{"data-testid":"tax-total-only",className:o(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[t("span",{className:"cart-order-summary__label",children:l.estimated?c.taxEstimated:c.taxTotalOnly}),t(h,{node:l.price,className:"cart-order-summary__price"})]}),f=y&&d("div",{"data-testid":"total-content",className:o(["cart-order-summary__entry","cart-order-summary__total",y.estimated&&"cart-order-summary__total--padded"]),children:[t("span",{className:o(["cart-order-summary__label","cart-order-summary__label--bold"]),children:y.estimated?c.totalEstimated:c.totalLabel}),t(h,{node:y.price,className:o(["cart-order-summary__price","cart-order-summary__price--bold"])})]}),I=y&&y.priceWithoutTax&&d("div",{"data-testid":"total-without-tax",className:o(["cart-order-summary__entry","cart-order-summary__totalWithoutTax"]),children:[t("span",{className:o(["cart-order-summary__label","cart-order-summary__label--muted"]),children:c.totalWithoutTax}),t(h,{node:y.priceWithoutTax,className:o(["cart-order-summary__price","cart-order-summary__price--muted"])})]}),k=E&&t("div",{className:o(["cart-order-summary__entry","cart-order-summary__primaryAction"]),children:E});return d("div",{...a,className:o(["cart-order-summary",["cart-order-summary--loading",W],[`cart-order-summary__${C}`,C],_]),children:[W&&t(mr,{className:"cart-order-summary__spinner"}),d("div",{className:"cart-order-summary__heading",children:[x&&t(h,{node:x,className:"cart-order-summary__heading-text"}),t(or,{variant:"primary",className:"cart-order-summary__divider-primary"})]}),d("div",{className:"cart-order-summary__content",children:[T,B,w,N,f,I,k]})]})},hr=({children:_,initialData:O=null,routeCheckout:C,slots:x,...W})=>{var w,N,f,I,k,m,A,F,z,G,V,Z,j,U,X,s,b;const[r,p]=J(O),g=r==null?void 0:r.isVirtual,{handleEstimateTotals:l,estimatedTotals:e,setEstimatedTotals:y,loading:E}=lr(),a=(w=ar.config)==null?void 0:w.shoppingCartDisplaySetting,v=(a==null?void 0:a.subtotal)==="INCLUDING_TAX",P=(a==null?void 0:a.subtotal)==="INCLUDING_EXCLUDING_TAX",c=a==null?void 0:a.zeroTax;Y(()=>{const n=M.on("cart/data",i=>{var S;p(i);const L=(S=i==null?void 0:i.addresses)==null?void 0:S.shipping,D=i==null?void 0:i.isVirtual;(L||D)&&y(null)},{eager:!0});return()=>{n==null||n.off()}},[]),Y(()=>{const n=M.on("shipping/estimate",i=>{var S,q,$,Q,R,K;const L={shippingCountry:(S=i==null?void 0:i.address)==null?void 0:S.countryCode,shippingState:(q=i==null?void 0:i.address)==null?void 0:q.region,shippingStateId:($=i==null?void 0:i.address)==null?void 0:$.regionId,shippingZip:(Q=i==null?void 0:i.address)==null?void 0:Q.postCode},D={carrier_code:((R=i==null?void 0:i.shippingMethod)==null?void 0:R.carrierCode)||"",method_code:((K=i==null?void 0:i.shippingMethod)==null?void 0:K.methodCode)||""};l(L,D)});return()=>{n==null||n.off()}},[l]);const T=rr({checkout:"Cart.PriceSummary.checkout",orderSummary:"Cart.PriceSummary.orderSummary",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined"}),B=!g&&(x!=null&&x.EstimateShipping)?t(tr,{name:"EstimateShipping",slot:x.EstimateShipping},"estimateShippingId"):void 0;return!Object.keys(r??{}).length||(r==null?void 0:r.totalQuantity)===0?null:t(yr,{...W,"data-testid":"cart-order-summary",heading:t("div",{children:T.orderSummary}),shipping:B,loading:E,subTotal:{taxIncluded:v&&!c,taxExcluded:P,zeroTaxSubtotal:c,priceExcludingTax:(N=e==null?void 0:e.estimatedSubTotal)!=null&&N.excludingTax?t(u,{"data-testid":"subtotal",...(f=e==null?void 0:e.estimatedSubTotal)==null?void 0:f.excludingTax}):t(u,{"data-testid":"subtotal",amount:(I=r==null?void 0:r.subtotal.excludingTax)==null?void 0:I.value,currency:(k=r==null?void 0:r.subtotal.excludingTax)==null?void 0:k.currency}),price:!c&&v||!c&&P?(m=e==null?void 0:e.estimatedSubTotal)!=null&&m.includingTax?t(u,{"data-testid":"subtotal",...(A=e==null?void 0:e.estimatedSubTotal)==null?void 0:A.includingTax}):t(u,{"data-testid":"subtotal",amount:(F=r==null?void 0:r.subtotal.includingTax)==null?void 0:F.value,currency:(z=r==null?void 0:r.subtotal.includingTax)==null?void 0:z.currency}):t(u,{"data-testid":"subtotal",amount:(G=r==null?void 0:r.subtotal.excludingTax)==null?void 0:G.value,currency:(V=r==null?void 0:r.subtotal.excludingTax)==null?void 0:V.currency})},discounts:r==null?void 0:r.appliedDiscounts.map(n=>({label:n.label,price:t(u,{"data-testid":"summary-discount-total",amount:-n.amount.value,currency:n.amount.currency,sale:!0})})),taxTotal:g?{price:t("span",{"data-testid":"tax-total",children:T.taxToBeDetermined})}:{price:e!=null&&e.estimatedTaxTotal?t(u,{"data-testid":"tax-total",...e==null?void 0:e.estimatedTaxTotal}):t(u,{"data-testid":"tax-total",amount:(Z=r==null?void 0:r.totalTax)==null?void 0:Z.value,currency:(j=r==null?void 0:r.totalTax)==null?void 0:j.currency}),estimated:(!e||!!(e!=null&&e.estimatedTaxTotal))&&!((U=r==null?void 0:r.addresses)!=null&&U.shipping)},taxesApplied:g?void 0:a!=null&&a.fullSummary?(s=((X=e==null?void 0:e.estimatedAppliedTaxes)==null?void 0:X.taxes)||(r==null?void 0:r.appliedTaxes))==null?void 0:s.map(n=>({label:n.label,price:t(u,{"data-testid":"applied-taxes",amount:n.amount.value,currency:n.amount.currency})})):void 0,total:{price:e!=null&&e.estimatedGrandTotalPrice?t(u,{...e==null?void 0:e.estimatedGrandTotalPrice.includingTax}):t(u,{amount:r==null?void 0:r.total.includingTax.value,currency:r==null?void 0:r.total.includingTax.currency}),estimated:(!e||!!(e!=null&&e.estimatedTaxTotal))&&!((b=r==null?void 0:r.addresses)!=null&&b.shipping),priceWithoutTax:a!=null&&a.grandTotal?e!=null&&e.estimatedAppliedTaxes?t(u,{...e==null?void 0:e.estimatedGrandTotalPrice.excludingTax}):t(u,{amount:r==null?void 0:r.total.excludingTax.value,currency:r==null?void 0:r.total.excludingTax.currency}):void 0},primaryAction:C&&t(ur,{"data-testid":"checkout-button",variant:"primary",disabled:r==null?void 0:r.hasOutOfStockItems,"aria-disabled":r==null?void 0:r.hasOutOfStockItems,href:r!=null&&r.hasOutOfStockItems?void 0:C({cartId:r.id}),children:T.checkout})})};hr.getInitialData=async function(){return ir()};export{hr as O};
