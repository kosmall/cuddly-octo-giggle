import{jsx as e,jsxs as d,Fragment as G}from"@dropins/tools/preact-jsx-runtime.js";import{useState as S,useEffect as f}from"@dropins/tools/preact-compat.js";import{classes as p,VComponent as _,Slot as I}from"@dropins/tools/lib.js";import{s as b,g as U}from"./state.js";import{events as O}from"@dropins/tools/event-bus.js";/* empty css             */import{Price as L,Button as k}from"@dropins/tools/components.js";import{useText as P}from"@dropins/tools/i18n.js";import{p as M,u as T}from"./updateProductsFromCart.js";import{C as D}from"./CartSummaryList.js";import"./OrderSummary.js";const Q=({className:h,products:n,orderSummary:a,empty:r,...i})=>e("div",{...i,className:p(["cart-cart",h]),children:d("div",{className:p(["cart-cart__wrapper"]),children:[e("div",{"data-testid":"cart-content",className:p(["cart-cart__content",["cart-cart__content--empty",r||a==null],["cart-cart__content--full-width",r||a==null]]),children:n&&e(_,{node:n})}),n&&a&&e(_,{node:a,className:p(["cart-cart__order-summary"])})]})}),X=({className:h,products:n,subtotal:a,subtotalExcludingTaxes:r,ctas:i,...l})=>{const o=P({subtotal:"Cart.MiniCart.subtotal",subtotalExcludingTaxes:"Cart.MiniCart.subtotalExcludingTaxes"});return e("div",{...l,className:p(["cart-mini-cart",h]),children:n&&d(G,{children:[e("div",{className:"cart-mini-cart__products","data-testid":"mini-cart-products-wrapper",children:n}),d("div",{className:"cart-mini-cart__footer","data-testid":"mini-cart-subtotals",children:[a&&d("div",{className:"cart-mini-cart__footer__estimated-total","data-testid":"mini-cart-subtotal",children:[o.subtotal,e(_,{node:a})]}),r&&d("div",{className:"cart-mini-cart__footer__estimated-total-excluding-taxes","data-testid":"mini-cart-subtotal-excluding-taxes",children:[o.subtotalExcludingTaxes,e(_,{node:r,className:p(["dropin-price-summary__price","dropin-price-summary__price--muted"])})]}),i&&e(_,{node:i,className:"cart-mini-cart__footer__ctas"})]})]})})},j=({children:h,routeProduct:n,routeEmptyCartCTA:a,slots:r,initialData:i=null,...l})=>{const[o,x]=S(i),t=(s,m)=>T([{uid:s,quantity:m}]);f(()=>{const s=O.on("cart/data",m=>{x(m)},{eager:!0});return()=>{s==null||s.off()}},[]),f(()=>{i&&Object.keys(i).length>0&&M(i,b.locale??"en-US")},[i]);const g=r!=null&&r.OrderSummary?e(I,{name:"OrderSummary",slot:r.OrderSummary}):void 0,c=s=>t(s,0),y=e(I,{name:"ProductList",slot:r==null?void 0:r.ProductList,context:{itemQuantityUpdateHandler:t,itemRemoveHandler:c},children:e(D,{"data-testid":"default-cart-summary-list",routeProduct:n,routeEmptyCartCTA:a,onItemQuantityUpdate:t,onItemRemove:c,initialData:o})});return e(Q,{...l,empty:((o==null?void 0:o.items)&&o.items.length===0)??!0,orderSummary:g,products:y})};j.getInitialData=async function(){return U()};const w=({children:h,initialData:n=null,slots:a,routeProduct:r,routeCart:i,routeCheckout:l,routeEmptyCartCTA:o,...x})=>{var C,N;const[t,g]=S(n),c=(C=b.config)==null?void 0:C.shoppingCartDisplaySetting;f(()=>{const u=O.on("cart/data",v=>{g(v)},{eager:!0});return()=>{u==null||u.off()}},[]);const y=P({cartLink:"Cart.MiniCart.cartLink",checkoutLink:"Cart.MiniCart.checkoutLink"}),s=(u,v)=>T([{uid:u,quantity:v}]),m=u=>s(u,0);f(()=>{n&&Object.keys(n).length>0&&M(n,b.locale||"en-US")},[n]);const E=e(I,{name:"ProductList",slot:a==null?void 0:a.ProductList,context:{itemQuantityUpdateHandler:s,itemRemoveHandler:m},children:e(D,{"data-testid":"default-cart-summary-list",routeProduct:r,routeEmptyCartCTA:o,onItemRemove:m,initialData:t,maxItems:(N=b.config)==null?void 0:N.miniCartMaxItemsDisplay})}),R=()=>(c==null?void 0:c.subtotal)==="INCLUDING_TAX"||(c==null?void 0:c.subtotal)==="INCLUDING_EXCLUDING_TAX"?{amount:t==null?void 0:t.subtotal.includingTax.value,currency:t==null?void 0:t.subtotal.includingTax.currency,"data-testid":"subtotal-including-tax",style:{font:"inherit"}}:{amount:t==null?void 0:t.subtotal.excludingTax.value,currency:t==null?void 0:t.subtotal.excludingTax.currency,"data-testid":"subtotal-excluding-tax",style:{font:"inherit"}};return e(X,{...x,subtotal:(t==null?void 0:t.subtotal)&&e(L,{...R()}),subtotalExcludingTaxes:(t==null?void 0:t.subtotal)&&((c==null?void 0:c.subtotal)==="INCLUDING_EXCLUDING_TAX"?e(L,{amount:t==null?void 0:t.subtotal.excludingTax.value,currency:t==null?void 0:t.subtotal.excludingTax.currency,"data-testid":"subtotal-including-excluding-tax",style:{font:"inherit"}}):void 0),ctas:d("div",{children:[l&&e(k,{"data-testid":"route-checkout-button",variant:"primary",href:t!=null&&t.hasOutOfStockItems?void 0:l(),disabled:t==null?void 0:t.hasOutOfStockItems,"aria-disabled":t==null?void 0:t.hasOutOfStockItems,children:y.checkoutLink}),i&&e(k,{"data-testid":"route-cart-button",variant:"tertiary",href:i(),children:y.cartLink})]}),products:E})};w.getInitialData=async function(){return U()};export{j as C,w as M};
