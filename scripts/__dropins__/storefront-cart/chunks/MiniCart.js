import{jsx as e,jsxs as p,Fragment as R}from"@dropins/tools/preact-jsx-runtime.js";import{useState as L,useEffect as g}from"@dropins/tools/preact-compat.js";import{classes as h,VComponent as f,Slot as k}from"@dropins/tools/lib.js";import{s as x,g as Q}from"./state.js";import{events as E}from"@dropins/tools/event-bus.js";/* empty css             */import{Price as U,Button as O}from"@dropins/tools/components.js";import{useText as M}from"@dropins/tools/i18n.js";import{p as P,u as T}from"./updateProductsFromCart.js";import{C as D}from"./CartSummaryList.js";import"./OrderSummary.js";const w=({className:y,products:n,orderSummary:i,empty:r,...a})=>e("div",{...a,className:h(["cart-cart",y]),children:p("div",{className:h(["cart-cart__wrapper"]),children:[e("div",{"data-testid":"cart-content",className:h(["cart-cart__content",["cart-cart__content--empty",r||i==null],["cart-cart__content--full-width",r||i==null]]),children:n&&e(f,{node:n})}),n&&i&&e(f,{node:i,className:h(["cart-cart__order-summary"])})]})}),G=({className:y,products:n,subtotal:i,subtotalExcludingTaxes:r,ctas:a,...l})=>{const o=M({subtotal:"Cart.MiniCart.subtotal",subtotalExcludingTaxes:"Cart.MiniCart.subtotalExcludingTaxes"});return e("div",{...l,className:h(["cart-mini-cart",y]),children:n&&p(R,{children:[e("div",{className:"cart-mini-cart__products","data-testid":"mini-cart-products-wrapper",children:n}),p("div",{className:"cart-mini-cart__footer","data-testid":"mini-cart-subtotals",children:[i&&p("div",{className:"cart-mini-cart__footer__estimated-total","data-testid":"mini-cart-subtotal",children:[o.subtotal,e(f,{node:i})]}),r&&p("div",{className:"cart-mini-cart__footer__estimated-total-excluding-taxes","data-testid":"mini-cart-subtotal-excluding-taxes",children:[o.subtotalExcludingTaxes,e(f,{node:r,className:h(["dropin-price-summary__price","dropin-price-summary__price--muted"])})]}),a&&e(f,{node:a,className:"cart-mini-cart__footer__ctas"})]})]})})},H=({children:y,routeProduct:n,routeEmptyCartCTA:i,slots:r,initialData:a=null,...l})=>{const[o,v]=L(a),[t,I]=L(new Map),c={hasErrors:t.size>0},m=(s,d)=>T([{uid:s,quantity:d}]);g(()=>{const s=E.on("cart/data",d=>{v(d)},{eager:!0});return()=>{s==null||s.off()}},[]),g(()=>{a&&Object.keys(a).length>0&&P(a,x.locale??"en-US")},[a]);const b=r!=null&&r.OrderSummary?e(k,{name:"OrderSummary",slot:r.OrderSummary,context:{...c}}):void 0,_=s=>m(s,0),C=e(k,{name:"ProductList",slot:r==null?void 0:r.ProductList,context:{itemQuantityUpdateHandler:m,itemRemoveHandler:_},children:e(D,{"data-testid":"default-cart-summary-list",routeProduct:n,routeEmptyCartCTA:i,onItemQuantityUpdate:m,onItemRemove:_,initialData:o,onItemsErrorsChange:I})});return e(w,{...l,empty:((o==null?void 0:o.items)&&o.items.length===0)??!0,orderSummary:b,products:C})};H.getInitialData=async function(){return Q()};const X=({children:y,initialData:n=null,slots:i,routeProduct:r,routeCart:a,routeCheckout:l,routeEmptyCartCTA:o,...v})=>{var d,S;const[t,I]=L(n),c=(d=x.config)==null?void 0:d.shoppingCartDisplaySetting;g(()=>{const u=E.on("cart/data",N=>{I(N)},{eager:!0});return()=>{u==null||u.off()}},[]);const m=M({cartLink:"Cart.MiniCart.cartLink",checkoutLink:"Cart.MiniCart.checkoutLink"}),b=(u,N)=>T([{uid:u,quantity:N}]),_=u=>b(u,0);g(()=>{n&&Object.keys(n).length>0&&P(n,x.locale||"en-US")},[n]);const C=e(k,{name:"ProductList",slot:i==null?void 0:i.ProductList,context:{itemQuantityUpdateHandler:b,itemRemoveHandler:_,totalQuantity:t==null?void 0:t.totalQuantity},children:e(D,{"data-testid":"default-cart-summary-list",routeProduct:r,routeEmptyCartCTA:o,onItemRemove:_,initialData:t,maxItems:(S=x.config)==null?void 0:S.miniCartMaxItemsDisplay,hideHeading:!(t!=null&&t.totalQuantity)})}),s=()=>(c==null?void 0:c.subtotal)==="INCLUDING_TAX"||(c==null?void 0:c.subtotal)==="INCLUDING_EXCLUDING_TAX"?{amount:t==null?void 0:t.subtotal.includingTax.value,currency:t==null?void 0:t.subtotal.includingTax.currency,"data-testid":"subtotal-including-tax",style:{font:"inherit"}}:{amount:t==null?void 0:t.subtotal.excludingTax.value,currency:t==null?void 0:t.subtotal.excludingTax.currency,"data-testid":"subtotal-excluding-tax",style:{font:"inherit"}};return e(G,{...v,subtotal:t!=null&&t.totalQuantity?(t==null?void 0:t.subtotal)&&e(U,{...s()}):void 0,subtotalExcludingTaxes:t!=null&&t.totalQuantity?(t==null?void 0:t.subtotal)&&((c==null?void 0:c.subtotal)==="INCLUDING_EXCLUDING_TAX"?e(U,{amount:t==null?void 0:t.subtotal.excludingTax.value,currency:t==null?void 0:t.subtotal.excludingTax.currency,"data-testid":"subtotal-including-excluding-tax",style:{font:"inherit"}}):void 0):void 0,ctas:t!=null&&t.totalQuantity?p("div",{children:[l&&e(O,{"data-testid":"route-checkout-button",variant:"primary",href:t!=null&&t.hasOutOfStockItems?void 0:l(),disabled:t==null?void 0:t.hasOutOfStockItems,"aria-disabled":t==null?void 0:t.hasOutOfStockItems,children:m.checkoutLink}),a&&e(O,{"data-testid":"route-cart-button",variant:"tertiary",href:a(),children:m.cartLink})]}):void 0,products:C})};X.getInitialData=async function(){return Q()};export{H as C,X as M};
