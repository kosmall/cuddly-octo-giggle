import{jsx as r,jsxs as y,Fragment as X}from"@dropins/tools/preact-jsx-runtime.js";import*as o from"@dropins/tools/preact-compat.js";import{useState as _,useEffect as q}from"@dropins/tools/preact-compat.js";import{classes as O,VComponent as A,Slot as H}from"@dropins/tools/lib.js";/* empty css             */import{E as pt}from"./EmptyCart.js";import{Divider as mt,Skeleton as ht,SkeletonRow as yt,InLineAlert as kt,Icon as V,CartList as M,CartItem as vt,Price as N,Image as Lt}from"@dropins/tools/components.js";import{s as It,g as Ct}from"./state.js";import{events as wt}from"@dropins/tools/event-bus.js";import{useText as St}from"@dropins/tools/i18n.js";const W=u=>o.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...u},o.createElement("g",{clipPath:"url(#clip0_4797_15331)"},o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M10.25 20.91L1.5 17.55V6.51996L10.25 9.92996V20.91Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.24023 4.64001L14.9902 8.06001V11.42",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{className:"error-icon",vectorEffect:"non-scaling-stroke",d:"M19 13.31L15.5 19.37H22.5L19 13.31Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{className:"error-icon",vectorEffect:"non-scaling-stroke",d:"M19.0202 17.11H18.9802L18.9502 15.56H19.0502L19.0202 17.11ZM18.9602 18.29V18.06H19.0502V18.29H18.9602Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19 12.16V6.51996L10.25 9.92996V20.91L14.27 19.37L14.4 19.32",stroke:"currentColor",strokeLinejoin:"round"}),o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M1.5 6.51999L10.25 3.04999L19 6.51999L10.25 9.92999L1.5 6.51999Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),o.createElement("defs",null,o.createElement("clipPath",{id:"clip0_4797_15331"},o.createElement("rect",{width:22,height:18.86,fill:"white",transform:"translate(1 2.54999)"})))),Et=u=>o.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...u},o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),_t=({className:u,children:U,heading:d,emptyCart:k,products:f,outOfStockMessage:p,loading:x=!0,...g})=>r("div",{...g,className:O(["cart-cart-summary-list",u]),children:x?r(Ot,{}):y(X,{children:[(d||p)&&y("div",{"data-testid":"cart-summary-list-heading-wrapper",className:O(["cart-cart-summary-list__heading",["cart-cart-summary-list__heading--full-width",!f]]),children:[d&&y(X,{children:[r(A,{node:d,className:"cart-cart-summary-list__heading-text"}),r(mt,{variant:"primary",className:O(["cart-cart-summary-list__heading-divider"])})]}),p&&r(A,{node:p,className:"cart-cart-summary-list__out-of-stock-message"})]}),r("div",{className:O(["cart-cart-summary-list__content",["cart-cart-summary-list__content--empty",!f]]),children:f||r(A,{node:k,className:"cart-cart-summary-list__empty-cart"})})]})}),Ot=()=>r(ht,{"data-testid":"cart-summary-list-skeleton",className:"cart-cart-summary-list__skeleton",rowGap:"medium",children:r(yt,{variant:"row",size:"xlarge",fullWidth:!0,lines:3,multilineGap:"small"})}),Nt=({initialData:u=null,hideHeading:U,routeProduct:d,routeEmptyCartCTA:k,onItemQuantityUpdate:f,onItemRemove:p,maxItems:x,slots:g,attributesToHide:m=[],onItemsErrorsChange:P,...B})=>{var $;const[R,F]=_(!u),[a,J]=_(u),[v,K]=_(new Set),[w,Y]=_(new Map),c=($=It.config)==null?void 0:$.shoppingCartDisplaySetting,i=St({file:"Cart.CartItem.file",files:"Cart.CartItem.files",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",recipient:"Cart.CartItem.recipient",regularPrice:"Cart.CartItem.regularPrice",discountedPrice:"Cart.CartItem.discountedPrice",sender:"Cart.CartItem.sender",lowInventory:"Cart.CartItem.lowInventory",insufficientQuantity:"Cart.CartItem.insufficientQuantity",insufficientQuantityGeneral:"Cart.CartItem.insufficientQuantityGeneral",outOfStockHeading:"Cart.OutOfStockMessage.heading",outOfStockDescription:"Cart.OutOfStockMessage.message",outOfStockAlert:"Cart.OutOfStockMessage.alert",removeAction:"Cart.OutOfStockMessage.action",notAvailableMessage:"Cart.CartItem.notAvailableMessage"}),Q=(t,e)=>{K(n=>(e?n.add(t):n.delete(t),new Set(n)))},j=(t,e)=>{Y(n=>(e?n.set(t,e):n.delete(t),new Map(n)))},G=(t,e)=>{Q(t,!0),j(t),p&&e===0?p(t).finally(()=>{Q(t,!1)}).catch(n=>{console.warn(n)}):f&&f(t,e).finally(()=>{Q(t,!1)}).catch(n=>{console.warn(n),j(t,n.message)})};q(()=>{const t=wt.on("cart/data",e=>{J(e),F(!1)},{eager:!0});return()=>{t==null||t.off()}},[]),q(()=>{P&&P(w)},[w,P]);const D=(t,e)=>{if(m.includes("image"))return;const n=r(Lt,{"data-testid":"cart-list-item-image",loading:e<4?"eager":"lazy",src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}});return d?r("a",{href:d(t),children:n}):n},tt=t=>{if(!m.includes("name"))return r("span",{"data-testid":"cart-list-item-title",children:d?r("a",{href:d(t),children:t.name}):t.name})},et=t=>{if(!m.includes("configurations"))return{...t.bundleOptions,...t.selectedOptions,...t.customizableOptions,...t.recipient?{[i.recipient]:t.recipient}:null,...t.recipientEmail&&t.recipient?{[i.recipient]:`${t.recipient} (${t.recipientEmail})`}:null,...t.sender?{[i.sender]:t.sender}:null,...t.senderEmail&&t.sender?{[i.sender]:`${t.sender} (${t.senderEmail})`}:{},...t.message?{[i.message]:t.message}:null,...t.links&&t.links.count?t.links.count>1?{[i.files.replace("{count}",t.links.count.toString())]:t.links.result}:{[i.file.replace("{count}",t.links.count.toString())]:t.links.result}:null}},nt=t=>{var e,n,l,s;return(c==null?void 0:c.price)==="INCLUDING_TAX"?t.discounted?{amount:t.regularPrice.value,currency:t.regularPrice.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}:{amount:(e=t.taxedPrice)==null?void 0:e.value,currency:(n=t.taxedPrice)==null?void 0:n.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}:{amount:(l=t.regularPrice)==null?void 0:l.value,currency:(s=t.regularPrice)==null?void 0:s.currency,style:{font:"inherit"},"data-testid":"regular-item-price"}},rt=t=>(c==null?void 0:c.price)==="INCLUDING_EXCLUDING_TAX"?r(N,{amount:t.rowTotal.value,currency:t.rowTotal.currency,"data-testid":"excluding-tax-total","aria-label":i.regularPrice}):void 0,at=t=>{var l,s,h,E,L,I,C,b,z,T;const e={"aria-label":i.regularPrice},n=t.discounted?{}:null;return["INCLUDING_TAX","INCLUDING_EXCLUDING_TAX"].includes(c==null?void 0:c.price)?(e.amount=(l=t.rowTotalIncludingTax)==null?void 0:l.value,e.currency=(s=t.rowTotalIncludingTax)==null?void 0:s.currency,e.variant=t.discounted?"strikethrough":"default",e["data-testid"]="including-tax-item-total",n&&(e.amount=(h=t.total)==null?void 0:h.value,e.currency=(E=t.total)==null?void 0:E.currency,n.amount=(L=t.rowTotalIncludingTax)==null?void 0:L.value,n.currency=(I=t.rowTotalIncludingTax)==null?void 0:I.currency,n.sale=!0,n["aria-label"]=i.discountedPrice,n["data-testid"]="discount-total")):(e.amount=(C=t.total)==null?void 0:C.value,e.currency=(b=t.total)==null?void 0:b.currency,e.variant=t.discounted?"strikethrough":"default",e["data-testid"]="regular-item-total",n&&(n.amount=(z=t.discountedTotal)==null?void 0:z.value,n.currency=(T=t.discountedTotal)==null?void 0:T.currency,n.sale=!0,n["aria-label"]=i.regularPrice,n["data-testid"]="discount-total")),{totalProps:e,discountProps:n}},it=t=>{var L,I,C;if(m.includes("warning"))return;const e=w.get(t.uid),n=(L=w.get(t.uid))==null?void 0:L.includes("The requested qty is not available"),l=v.has(t.uid),s=t.insufficientQuantity&&t.stockLevel?t.stockLevel==="noNumber"?i.insufficientQuantityGeneral:i.insufficientQuantity.replace("{inventory}",(I=t.stockLevel)==null?void 0:I.toString()).replace("{count}",t.quantity.toString()):"",h=t.lowInventory&&t.onlyXLeftInStock&&i.lowInventory.replace("{count}",(C=t.onlyXLeftInStock)==null?void 0:C.toString()),E=!t.outOfStock&&e&&n?i.notAvailableMessage:e;return!l&&(e||t.insufficientQuantity||t.lowInventory)?y("span",{"data-testid":"item-warning",children:[r(V,{source:Et,size:"16"}),E||s||h]}):void 0},ct=t=>m!=null&&m.includes("alert")?void 0:!v.has(t.uid)&&t.outOfStock?y("span",{"data-testid":"item-alert",children:[r(V,{source:W,size:"16"}),i.outOfStockAlert]}):void 0,ot=t=>r("span",{"data-testid":"cart-list-item-sku",children:t.sku}),Z=t=>a!=null&&a.totalQuantity?a.items.filter(t).map((e,n)=>{const{totalProps:l,discountProps:s}=at(e);return r(vt,{updating:v==null?void 0:v.has(e.uid),"data-testid":`cart-list-item-entry-${e.uid}`,image:D(e,n),title:tt(e),sku:ot(e),price:r(N,{...nt(e)}),quantity:e.quantity,total:y(X,{children:[r(N,{...l}),s&&r(N,{...s})]}),configurations:et(e),totalExcludingTax:rt(e),taxIncluded:(c==null?void 0:c.price)==="INCLUDING_TAX",taxExcluded:(c==null?void 0:c.price)==="INCLUDING_EXCLUDING_TAX",warning:it(e),alert:ct(e),onQuantity:f?h=>{G(e.uid,h)}:void 0,onRemove:p?()=>G(e.uid,0):void 0},e.uid)}):null,st=r(H,{name:"EmptyCart",slot:g==null?void 0:g.EmptyCart,context:{},children:r(pt,{"data-testid":"empty-cart",ctaLinkURL:k==null?void 0:k()})}),lt=r(H,{name:"Heading",slot:g==null?void 0:g.Heading,context:{count:a==null?void 0:a.totalQuantity},children:r("div",{"data-testid":"default-cart-heading",children:i.heading.replace("({count})",a!=null&&a.totalQuantity?`(${a==null?void 0:a.totalQuantity.toString()})`:"")})}),ut=()=>{const t=a==null?void 0:a.items.filter(e=>e.outOfStock);t==null||t.forEach(e=>{G(e.uid,0)})},dt=Z(t=>t.outOfStock||t.insufficientQuantity||!1),gt=a!=null&&a.hasOutOfStockItems?r(kt,{"data-testid":"cart-out-of-stock-message",icon:r(V,{source:W,size:"16"}),itemList:r(M,{"data-testid":"out-of-stock-cart-items",children:dt}),type:"warning",heading:i.outOfStockHeading,description:i.outOfStockDescription,variant:"primary",actionButtonPosition:"bottom",additionalActions:a!=null&&a.hasFullyOutOfStockItems?[{label:i.removeAction,onClick:ut}]:void 0}):void 0,S=Z(t=>!t.outOfStock&&!t.insufficientQuantity),ft=a!=null&&a.totalQuantity?r(M,{"data-testid":"cart-list",children:S==null?void 0:S.slice(0,x??S.length)}):null;return r(_t,{...B,heading:U?void 0:lt,loading:R,emptyCart:st,products:ft,outOfStockMessage:gt})};Nt.getInitialData=async function(){return Ct()};export{Nt as C};
