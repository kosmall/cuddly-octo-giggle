import{jsx as s,jsxs as c,Fragment as _}from"@dropins/tools/preact-jsx-runtime.js";import{classes as O,Slot as b}from"@dropins/tools/lib.js";import{Card as x,Icon as N,Image as T,Header as w}from"@dropins/tools/components.js";import"@dropins/tools/event-bus.js";import{useCallback as H,useState as C,useEffect as F}from"@dropins/tools/preact-hooks.js";import"../chunks/addressField.config.js";import{C as S}from"../chunks/OrdersListCard.js";import"@dropins/tools/preact-compat.js";import{c as m,S as I}from"../chunks/checkIsFunction.js";import{useText as v}from"@dropins/tools/i18n.js";import{g as $}from"../chunks/getOrderHistoryList.js";import"@dropins/tools/fetch-graphql.js";const k={size:"64",stroke:"4"},y=({routeOrdersList:r,onSelectId:t,selectedId:d="",minifiedView:a,redirectButtonText:p})=>{const l=v({viewAllOrders:"Account.OrdersList.viewAllOrders"}),o=m(r)?r():"#",e=H(u=>{m(r)||(u.preventDefault(),t&&d&&(t==null||t(d)))},[t,r,d]);return a?s("a",{className:O(["dropin-orders-list-action",["dropin-orders-list-action--minifiedView",a]]),"data-testid":"ordersListActionButtonMinifiedView",href:o,onClick:e,children:s(x,{"data-testid":"ordersListActionMinifiedView",variant:"secondary",children:c("div",{className:"dropin-orders-list-action__card-wrapper",children:[c("p",{children:[" ",p||l.viewAllOrders]}),s(N,{source:I,...k})]})})}):s("a",{href:o,onClick:e,className:"dropin-orders-list-action","data-testid":"ordersListActionButton",children:s(N,{source:I,...k})})},j=({item:r,withThumbnails:t,children:d,slots:a,...p})=>{var o,e,u,L;const l=v({orderNumber:"Account.OrdersListCard.orderNumber",itemsLength:"Account.OrdersListCard.itemsLength"});return c(x,{...p,className:O(["dropin-orders-list-card",["dropin-orders-list-card--full",((o=r==null?void 0:r.items)==null?void 0:o.length)>6]]),variant:"secondary",children:[s("div",{className:"dropin-orders-list-card--content",children:a!=null&&a.OrdersListCard?s(b,{"data-testid":`ordersListCard${r.id}`,name:"OrdersListCard",slot:a==null?void 0:a.OrdersListCard,context:{orderHistoryListItem:r}}):c(_,{children:[s("div",{children:r==null?void 0:r.status}),s("p",{children:r==null?void 0:r.orderDate}),c("p",{children:[l.orderNumber," ",r.number]}),c("p",{children:["$",(e=r==null?void 0:r.total)==null?void 0:e.grand_total.value]}),c("p",{children:[(u=r==null?void 0:r.items)==null?void 0:u.length," ",l.itemsLength]})]})}),t&&((L=r==null?void 0:r.items)!=null&&L.length)?s("div",{className:"dropin-orders-list-card--images","data-testid":"ordersListCardImages",children:r.items.map((i,h)=>{var g,A;const n=(A=(g=i==null?void 0:i.product)==null?void 0:g.small_image)==null?void 0:A.url,f=i==null?void 0:i.product_name;return s(T,{src:n,width:65,height:65,alt:f},i.id+h)})}):null,s("div",{className:"dropin-orders-list-card--actions",children:d})]})},B=({ordersInMinifiedView:r,minifiedView:t,pageSize:d})=>{const[a,p]=C([]),[l,o]=C({}),[e,u]=C(""),[L,i]=C(!1);F(()=>{i(!0),$(t?r:d).then(n=>{!n||!n.items||(o(n.pageInfo),p(n.items))}).finally(()=>{i(!1)})},[t,r,d]);const h=H(n=>{u(n)},[]);return{loading:L,orderHistoryListItems:a,pageInfo:l,selectedId:e,handleSelectId:h}},W=({className:r,slots:t,minifiedView:d=!1,withThumbnails:a=!0,withFilter:p=!0,ordersInMinifiedView:l=1,pageSize:o=10,redirectButtonText:e,routeOrdersList:u})=>{const L=v({settingsOrderListTitle:"Account.ContainersTitle.settingsOrderListTitle"}),{loading:i,orderHistoryListItems:h,handleSelectId:n}=B({minifiedView:d,pageSize:o,ordersInMinifiedView:l});return!(h!=null&&h.length)&&!i?null:i?s(S,{}):c(_,{children:[d?null:s(w,{title:L.settingsOrderListTitle}),c("div",{className:O(["dropin-orders-list",r]),children:[h.map((f,g)=>s(j,{item:f,withThumbnails:a,slots:t,children:t!=null&&t.OrdersListAction?s(b,{"data-testid":`ordersListActionSlot_${g}`,name:"OrdersListAction",slot:t==null?void 0:t.OrdersListAction,context:{handleSelectId:n,orderHistoryListItem:f}}):s(y,{onSelectId:n,selectedId:f.id})},g)),d?s(y,{minifiedView:d,onSelectId:n,routeOrdersList:u,redirectButtonText:e}):null]})]})};export{W as OrdersList,W as default};
