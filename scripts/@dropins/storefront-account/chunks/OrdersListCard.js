import{jsx as a,Fragment as N,jsxs as W}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as S,useState as _,useEffect as I,useCallback as D}from"@dropins/tools/preact-hooks.js";import{useText as w}from"@dropins/tools/i18n.js";import{classes as y}from"@dropins/tools/lib.js";import{memo as m,useCallback as q}from"@dropins/tools/preact-compat.js";import{Field as T,Picker as O,Input as j,InputDate as R,Checkbox as P,Skeleton as M,SkeletonRow as p,Card as U}from"@dropins/tools/components.js";import{F as V}from"./addressField.config.js";const A=r=>r.reduce(($,{code:E,required:z,defaultValue:s})=>(z&&($[E]=s),$),{}),X=({fieldsConfig:r,onSubmit:$,handleSetCountryCode:E})=>{const{requiredFieldError:z}=w({requiredFieldError:"Account.FormText.requiredFieldError"}),s=S(null),[c,i]=_({}),[d,k]=_({});I(()=>{if(!r||!r.length)return;const l=A(r);i(l)},[r==null?void 0:r.length]);const[F,v]=_({previousCountryCode:null,previousRegionCode:null,initialLoad:!0});I(()=>{var b;const l=c.country_code,t=r==null?void 0:r.find(u=>u.code==="region");if(F.initialLoad)v(u=>({...u,previousCountryCode:l,initialLoad:!1}));else if(F.previousCountryCode!==l){v(n=>({...n,previousCountryCode:l}));const u=!((b=t==null?void 0:t.options)!=null&&b.length)&&!(t!=null&&t.defaultValue)||F.previousRegionCode?"":(t==null?void 0:t.defaultValue)??"";i(n=>({...n,region:u})),E(l)}t!=null&&t.defaultValue&&F.previousCountryCode===l&&v(u=>({...u,previousRegionCode:t.defaultValue}))},[r,c,F.previousCountryCode,F.initialLoad,F.previousRegionCode,E,i]),I(()=>{if(!(r!=null&&r.length))return;const l=A(r);i(l)},[r==null?void 0:r.length]);const L=D((l,t)=>{const b=r.find(n=>n.code===l);return b!=null&&b.required&&!t?z:""},[r,z]),e=D(l=>{const{name:t,value:b,type:u,checked:n}=l==null?void 0:l.target,f=u==="checkbox"?n:b;i(x=>({...x,[t]:f}))},[]),o=D(l=>{const{name:t,value:b,type:u,checked:n}=l==null?void 0:l.target,f=u==="checkbox"?n:b;k(x=>({...x,[t]:L(t,f)}))},[L]),h=D(l=>{l.preventDefault();let t=!0,b={},u=null;for(const[n,f]of Object.entries(c)){const x=L(n,f);x&&(b[n]=x,t=!1,u||(u=n))}if(k(b),u&&s.current){const n=s.current.elements.namedItem(u);n==null||n.focus()}$==null||$(l,t)},[c,L,$]);return{formData:c,errors:d,formRef:s,handleChange:e,handleBlur:o,handleSubmit:h}},G=m(({loading:r,values:$,fields:E=[],errors:z,className:s="",onChange:c,onBlur:i})=>{const d=`${s}__field`,k=q((e,o,h)=>a(T,{error:h,className:y([d,`${d}--${e.id}`,[`${d}--${e.id}-hidden`,e.is_hidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(O,{name:e.id,floatingLabel:`${e.label} ${e.required?"*":""}`,placeholder:e.label,"aria-label":e.label,options:e.options,onBlur:i,handleSelect:c,value:o||e.defaultValue})},e.id),[s,r,d,i,c]),F=q((e,o,h)=>a(T,{error:h,className:y([d,`${d}--${e.id}`,[`${d}--${e.id}-hidden`,e.is_hidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(j,{type:"text",name:e.id,value:o===void 0?e.defaultValue:o,placeholder:e.label,floatingLabel:`${e.label} ${e.required?"*":""}`,onBlur:i,onChange:c})},e.id),[s,r,d,i,c]),v=q((e,o,h)=>a(T,{error:h,className:y([d,`${d}--${e.id}`,[`${d}--${e.id}-hidden`,e.is_hidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(R,{type:"text",name:e.id,value:o||e.defaultValue,placeholder:e.label,floatingLabel:`${e.label} ${e.required?"*":""}`,onBlur:i,onChange:c})},e.id),[s,r,d,i,c]),L=q((e,o,h)=>a(T,{error:h,className:y([d,`${d}--${e.id}`,[`${d}--${e.id}-hidden`,e.is_hidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(P,{name:e.id,checked:o||e.defaultValue,placeholder:e.label,label:`${e.label} ${e.required?"*":""}`,onBlur:i,onChange:c})},e.id),[s,r,d,i,c]);return E.length?a(N,{children:E.map(e=>{const o=(z==null?void 0:z[e.id])??void 0,h=($==null?void 0:$[e.id])??void 0;switch(e.fieldType){case V.TEXT:return e.options.length?k(e,h,o):F(e,h,o);case V.MULTILINE:return F(e,h,o);case V.SELECT:return k(e,h,o);case V.DATE:return v(e,h,o);case V.BOOLEAN:return L(e,h,o);default:return null}})}):null}),g=m(({name:r,loading:$,children:E,className:z="defaultForm",fieldsConfig:s,onSubmit:c,handleSetCountryCode:i})=>{const{formData:d,errors:k,formRef:F,handleChange:v,handleBlur:L,handleSubmit:e}=X({fieldsConfig:s,onSubmit:c,handleSetCountryCode:i});return W("form",{className:y(["dropin-form",z]),onSubmit:e,name:r,ref:F,children:[a(G,{className:z,loading:$,fields:s,onChange:v,onBlur:L,errors:k,values:d}),E]})}),C=({testId:r,withCard:$=!0})=>{const E=W(M,{"data-testid":r||"skeletonLoader",children:[a(p,{variant:"heading",size:"xlarge",fullWidth:!1,lines:1}),a(p,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1}),a(p,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1})]});return $?E:a(U,{variant:"secondary",className:y(["dropin-account-loaders","dropin-account-loaders--card-loader"]),children:E})},ee=()=>W(M,{"data-testid":"addressFormLoader",children:[a(p,{variant:"heading",size:"medium"}),a(p,{variant:"empty",size:"medium"}),a(p,{size:"large"}),a(p,{size:"large"}),a(p,{size:"large",fullWidth:!0}),a(p,{size:"large",fullWidth:!0,lines:3}),a(p,{size:"large"}),a(p,{size:"large"}),a(p,{size:"large"}),a(p,{size:"large"}),a(p,{size:"large"}),a(p,{size:"large"}),a(p,{size:"large",fullWidth:!0})]});export{ee as A,C,g as F};
